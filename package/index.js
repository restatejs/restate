!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Restate=t():(e.Restate=e.Restate||{},e.Restate.index=t())}(this,(()=>(()=>{"use strict";var e={607:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(752);s.__exportStar(r(434),t),s.__exportStar(r(502),t),s.__exportStar(r(583),t),s.__exportStar(r(899),t),s.__exportStar(r(929),t)},899:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionModel=void 0;const s=r(734),o=r(593),i=r(583);class u extends i.HTTPModel{constructor({resourceName:e,primaryKey:t,axios:r,computedProperties:s={},mapAfterRequest:i}){super({resourceName:e,axios:r}),this.$resource=(0,o.useCollectionResource)({primaryKey:t,computedProperties:s}),this.$primaryKey=t,this.$mapAfterRequest=i}data(e){const{sort:t,filter:r}=e??{};let o=this.$resource.getAll();return(r||t)&&(o=(0,s.computed)((()=>{let e=[...this.$resource.getAll().value];if(r&&(e="function"==typeof r?e.filter(r):e.filter(((e,t,s)=>!r.map((r=>r(e,t,s))).includes(!1)))),t){const r="function"==typeof t?t:(e,r)=>`${e?.[t]}`.localeCompare(`${r?.[t]}`);e.sort(r)}return e}))),o}item(e){return this.$resource.get(e)}index(e){return this.request(`/${this.$resourceName}`,{method:"GET",query:e?.query,afterRequest:t=>{const r=this.$mapAfterRequest?t.map(this.$mapAfterRequest):t;this.$resource.setAll(r,{clear:e?.clear})}})}show(e,t){return this.request(`/${this.$resourceName}/${e}`,{method:"GET",query:t?.query,afterRequest:t=>{const r=this.$mapAfterRequest?.(t)??t;this.$resource.set(e,r)}})}store(e,t){return this.request(`/${this.$resourceName}`,{method:"POST",query:t?.query,data:e,afterRequest:t=>{const r=this.$mapAfterRequest?.(t)??t,s=e[this.$primaryKey];this.$resource.set(s,r)}})}update(e,t,r){return this.request(`/${this.$resourceName}/${e}`,{method:"PUT",query:r?.query,data:t,afterRequest:()=>{Object.entries(t).forEach((([t,r])=>{this.$resource.setProperty(e,t,r)}))}})}destroy(e,t){return this.request(`/${this.$resourceName}/${e}`,{method:"DELETE",query:t?.query,afterRequest:()=>this.$resource.delete(e)})}}t.CollectionModel=u},583:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HTTPModel=void 0;const s=r(149);t.HTTPModel=class{constructor({resourceName:e,axios:t,afterRequest:r}){this.$resourceName=e,this.$axios=t,this.$afterRequest=r}request(e,t,r){return(0,s.load)((async()=>{const{data:r}=await this.$axios.request({url:e,method:t?.method,params:t?.query,data:t?.data});this.$afterRequest&&await this.$afterRequest(r),t?.afterRequest&&await t.afterRequest(r)}),r)}}},929:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemModel=void 0;const s=r(731),o=r(583);class i extends o.HTTPModel{constructor({resourceName:e,axios:t,computedProperties:r={},mapAfterRequest:o}){super({resourceName:e,axios:t}),this.$resource=(0,s.useItemResource)({computedProperties:r}),this.$mapAfterRequest=o}data(){return this.$resource.get()}show(e){return this.request(`${this.$resourceName}`,{method:"GET",query:e?.query,afterRequest:e=>{const t=this.$mapAfterRequest?.(e)??e;this.$resource.set(t)}})}update(e,t){return this.request(`/${this.$resourceName}`,{method:"PUT",query:t?.query,data:e,afterRequest:()=>{Object.entries(e).forEach((([e,t])=>{this.$resource.setProperty(e,t)}))}})}}t.ItemModel=i},434:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionResource=void 0;t.CollectionResource=class{constructor({primaryKey:e,indexes:t,state:r,computedProperties:s}){this.$primaryKey=e,this.$indexes=t,this.$state=r,this.$computedPropertiesMap=new Map(Object.entries(s))}get(e){const t=this.$indexes.get(e);return void 0!==t?this.$state.value[t]:void 0}getAll(){return this.$state}set(e,t){let r=this.$indexes.get(e);return void 0===r?(r=this.$state.value.length,this.$indexes.set(e,r),this.$state.value[r]=this.$defineItemComputedProperties(t)):this.$state.value[r]=this.$defineItemComputedProperties(t),r}setAll(e,t){!1===t?.clear?this.$indexes.setAll(e.map(((e,t)=>[e[this.$primaryKey],t])),{clear:!1}):(this.clear(),this.$indexes.setAll(e.map(((e,t)=>[e[this.$primaryKey],t])))),this.$state.value=e.map((e=>this.$defineItemComputedProperties(e)))}setProperty(e,t,r){const s=this.$indexes.get(e);if(void 0===s)throw new Error("Property not updated.");const o=this.$state.value[s];if(void 0===o)throw new Error("Property not updated.");o[t]=r,this.$defineItemComputedProperties(o)}has(e){return this.$indexes.has(e)}delete(e){const t=this.$indexes.get(e);if(void 0===t)throw new Error("Item not removed.");this.$state.value.splice(t,1),this.$indexes.delete(e)}clear(){this.$indexes.clear(),this.$state.value=[]}$defineItemComputedProperties(e){return this.$computedPropertiesMap.forEach(((t,r)=>{e[r]=t(e)})),e}}},190:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Indexes=void 0;const s=r(734);t.Indexes=class{constructor(){this.$storage=(0,s.ref)({})}get(e){return this.$storage.value[e]}set(e,t){this.$storage.value[e]=t}setAll(e,t){!1===t?.clear?e.forEach((([e,t])=>this.set(e,t))):this.$storage.value=Object.fromEntries(e)}has(e){return e in this.$storage.value}delete(e){if(void 0===this.$storage.value[e])throw new Error("Index not removed.");delete this.$storage.value[e]}clear(){this.$storage.value={}}}},502:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemResource=void 0;t.ItemResource=class{constructor({state:e,computedState:t}){this.$state=e,this.$computedState=t}get(){return this.$computedState}set(e){this.$state.value=e}setProperty(e,t){const r=this.$state.value;if(!r)throw new Error("Property not updated.");r[e]=t}has(){return!!this.$state.value}clear(){this.$state.value=void 0}}},593:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useCollectionResource=void 0;const s=r(734),o=r(434),i=r(190);t.useCollectionResource=function({primaryKey:e,computedProperties:t={}}){const r=new i.Indexes,u=(0,s.ref)([]);return new o.CollectionResource({primaryKey:e,indexes:r,state:u,computedProperties:t})}},731:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useItemResource=void 0;const s=r(734),o=r(502);t.useItemResource=function(e){const t=(0,s.ref)(void 0),r=function(e,t){return(0,s.computed)((()=>{if(!e.value)return;const r={...e.value};return t.forEach(((e,t)=>{if(t in r)throw new Error(`The ${String(t)} property is already defined.`);r[t]=e(r)})),r}))}(t,new Map(Object.entries(e?.computedProperties||[])));return new o.ItemResource({state:t,computedState:r})}},149:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.load=void 0;const s=r(734);t.load=function(e,t){const r=(0,s.ref)(!0),o={loaded:(async()=>(await e(),r.value=!1,!0))(),loading:r};return t&&(o.data=t),o}},752:e=>{e.exports=require("tslib")},734:e=>{e.exports=require("vue")}},t={};var r=function r(s){var o=t[s];if(void 0!==o)return o.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,r),i.exports}(607);return r})()));